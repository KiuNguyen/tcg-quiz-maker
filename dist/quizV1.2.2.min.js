function quizWidget(h){var i=h("[data-quiz-config]").data("quizConfig"),t={options:{getStartedButtonClass:"quiz-widget__get-started-button",getStartedContainerClass:"quiz-widget__get-started",getStartedText:"Not sure which bed you need? Take our quick Sleep Selector quiz and we'll recommend the right bed for you.",quizTabs:"#quiz-tabs",questionTitle:".qp_qi",questionPicture:".qp_pic",learnMoreClass:"quiz-widget__learn-more",quizResults:"#quiz-results",quizContainer:".quiz-container",quizWrapper:".quiz-widget__wrapper",progressBarWrapperClass:"quiz-widget__progress-bar-wrapper",progressBar:".quiz-widget__progress-bar",progressLine:".quiz-widget__progress-line",progressBarItems:".quiz-widget__progress-bar-item",leadsDataStorageKey:"leads-data",formQuestionsClass:"quiz-widget__send-results-questions",formWrapperClass:"quiz-widget__send-results-wrapper",formSubmitButtonClass:"quiz-widget__send-results-submit",formCloseButtonClass:"quiz-widget__send-results-close"},_loadQuiz:function(){var s=this;qz.setKey(i.publicKey),qz.load({quiz:i.quizId,parent:i.quizParent,onCreate:function(t){s.questions=t.schema.questions,quiz.xSend=function(t,e,i){return!!t&&!!t.d&&0<h("#quiz-ntabs").length&&s._setLeadsDataToStorage(t),document.qzScript?qz.xSend(t,e,i):xSend(t,e,i)},s._init()}})},_buildLoadEmailMeResultsPopup:function(){var o,t=localStorage.getItem(this.options.leadsDataStorageKey),t=t&&JSON.parse(t);t&&(this.leadsObject=t,t=this._getLeadsQuestions(t.d),o="",h.each(t,function(t,e){var i="text",s=("Email"===e.format&&(i="email"),"Number"===e.format&&(i="number"),"checkbox"===(i="Checkboxes"===e.type?"checkbox":i)),n=s?'<label for="'+e.id+'">'+e.question+"</label>":"",r=s?"":e.question;o+='<div class="'+(s?"quiz-widget__send-results-question  checkbox":"quiz-widget__send-results-question")+'" data-id="'+e.id+'"><div class="'+(s?"quiz-widget__send-results-question-control  checkbox":"quiz-widget__send-results-question-control")+'"><input id="'+e.id+'" type="'+i+'" placeholder="'+r+'"></div>'+n+"</div>"}),t=h('<div class="'+this.options.formWrapperClass+'" style="display: none"><div class="quiz-widget__send-results"><button class="'+this.options.formCloseButtonClass+'"></button><div class="quiz-widget__send-results-title">Get your results in your inbox</div><div class="quiz-widget__send-results-subtitle">Thanks for completing the Sleep Selector. Enter in your details below and we’ll email you your results straight to your inbox.</div><div class="'+this.options.formQuestionsClass+'">'+o+'</div><button class="'+this.options.formSubmitButtonClass+'">submit</button></div></div>'),h("#quiz").append(t))},_sendForm:function(){var t=this.options,t=h("."+t.formQuestionsClass+" [data-id]");if(this._validateForm(t)){var e,o=this.decodedJson,i=(o.ans=o.ans.split("Ñ")[0],h.each(t,function(t,e){var e=h(e),i=e.data("id"),e=e.find("input"),s="checkbox"===e.attr("type"),n=e.val(),r="";r=s?"Ñ"+i+"¦"+(n=e.is(":checked")?"1":"")+"¦":"Ñ"+i+"¦999¦"+n,o.ans+=r}.bind(this)),[]);for(e in o)o.hasOwnProperty(e)&&i.push(encodeURIComponent(e)+"="+encodeURIComponent(o[e]));t=i.join("&");this._sendRequest(t).then(function(){this._triggerFormVisibility(!1)}.bind(this),function(t){console.error(t),this._triggerFormVisibility(!1)}.bind(this))}},_sendRequest:async function(t){return await quiz.xSend({s:this.leadsObject.s,d:t,cb:quiz.gcpCB,noLog:1})},_validateForm:function(t){var o=!0,a="Incorrect form input";return h.each(t,function(t,e){var e=h(e),i=e.data("id"),e=e.find("input"),s=e.attr("type"),n="email"===s,s="checkbox"===s,r=e.val();return a="",12748425==+i||(a=n?"Please provide correct email address":s?"please select: "+this.questions["Q"+i].question:this.questions["Q"+i].question+" is required",o=s?!!e.is(":checked"):n?/(.+)@(.+){2,}\.(.+){2,}/.test(r):!!r)}.bind(this)),o||quiz.msg(a),o},_getLeadsQuestions:function(t){return this.decodedJson=JSON.parse('{"'+decodeURI(t).replace(/"/g,'\\"').replace(/&/g,'","').replace(/=/g,'":"')+'"}'),this.decodedJson.ans.split("Ñ").filter(function(t){t=t.split("¦");return 1<t.length&&t}).map(function(t){var t=t.split("¦"),e="Q"+t[0],e=this.questions[e];return e.savedAnswer=t[2],e.id=t[0],e}.bind(this))},_setLeadsDataToStorage:function(t){localStorage.setItem(this.options.leadsDataStorageKey,JSON.stringify(t))},_create:function(){i.publicKey&&i.quizParent&&i.quizId&&(this._loadQuiz(),quiz.addCB("afterResults",function(){this._processLeads(),this.quizTime&&(clearTimeout(this.quizTime),this.quizTime=null),h(this.options.quizContainer).toggleClass("results",this._isResultsStep()),this._triggerProgressBarVisibility(!1),this._removeBaseStyles(),this._isResultsStep()&&(this._buildLoadEmailMeResultsPopup(),this._loadReviews())}.bind(this)),quiz.addCB("Next",function(t){this._updateProgressBar(t.frompage+1)}.bind(this)),quiz.addCB("Back",function(t){this._updateProgressBar(t.frompage-1)}.bind(this)))},getSelectedQuestionData:function(t){var t=t-1,e=h(this.options.quizTabs+"> div").eq(t),i=e.find(".qp_qi > div").eq(0).text(),e=e.find("[sel=1]");return{questionIndex:t,questionText:i,answerIndex:e.parents(".qp_flexc").index(),answerText:e.find(".qp_t").text()}},_loadReviews:function(){var t,e;i.reviewsPublicKey&&((t=document.createElement("script")).type="text/javascript",t.async=!0,t.src="//staticw2.yotpo.com/"+i.reviewsPublicKey+"/widget.js",(e=document.getElementsByTagName("script")[0]).parentNode.insertBefore(t,e))},_processLeads:function(){h("#quiz-ntabs").length&&(this._replacePlaceholders(),this._replaceButtons())},_replacePlaceholders:function(){var t,e=[{old:"Enter number here",new:"Phone number"},{old:"Email",new:"Email address"}];for(t in e){var i=e[t],s=h('input[placeholder="'+i.old+'"]');s.length&&s.attr("placeholder",i.new)}},_replaceButtons:function(){h("#quiz-end input").val("Submit"),h("#quiz-skip input").val("No thanks, show me my results")},_updateProgressBar:function(t){var e=this._getTabs(),t=t||+e.siblings(".sel").attr("tid"),i=h(this.options.progressBarItems),e=t/e.length*100,e=(h(this.options.progressLine).css({width:e+"%"}),i.removeClass("active"),i.eq(t-1)),i=e.offset();e.addClass("active"),i&&h(this.options.progressBar).stop().animate({scrollLeft:i.left-20},500)},_isResultsStep:function(){return 0<h(this.options.quizResults).length},_init:function(){this._prepareWidget(),this._initEvents()},_prepareWidget:function(){this._applyStyles(),this._isQuizInProgress()?this._beginQuiz():(this._createGetStarted(),this._updateQuestionsHtml())},_isQuizInProgress:function(){var t=i.quizId.substring(1);return-1!==window.location.hash.indexOf(t)},_applyStyles:function(){var t=i.styles;this._removeBaseStyles(),t?((t=h("<link/>",{rel:"stylesheet",type:"text/css",href:t})).on("load",function(){this._triggerQuizWrapperVisibility(!0)}.bind(this)),t.appendTo(this._getWrapper())):this._triggerQuizWrapperVisibility(!0)},_removeBaseStyles:function(){this._getParent().find("link").remove(),h(".qp_quiz").attr("style","")},_getParent:function(){return h("#"+i.quizParent)},_getWrapper:function(){return h("."+i.quizWrapper)},_getTabs:function(){return h(this.options.quizTabs+">div")},_updateQuestionsHtml:function(){var c=this._getTabs(),g=this.options,p=h('<div style="display: none" class="'+g.progressBarWrapperClass+'"><div class="quiz-widget__progress-line-wrapper"><div class="quiz-widget__progress-line"></div></div><div class="quiz-widget__progress-bar"></div></div>');h.each(c,function(t,e){var e=h(e),i=e.find(g.questionTitle),t=h('<div class="quiz-widget__question-index-of-total-text">Question '+(t+1)+" of "+c.length+"</div>"),s=i.find("code"),n=s.data("title"),r=s.data("text"),s=s.data("progressbar"),o=e.find(g.questionPicture),a=o.css("background-image"),u=h('<button class="quiz-widget__learn-more-open"></button>'),d=h('<button class="quiz-widget__learn-more-close"></button>'),l="quiz-widget__learn-more-holder",n=h('<div style="display: none" class='+this.options.learnMoreClass+'><div class="'+l+'"><div class="quiz-widget__learn-more-column quiz-widget__learn-more-column--info"><h3>'+n+'</h3><div class="quiz-widget__learn-more-text">'+r+'</div></div><div class="quiz-widget__learn-more-column quiz-widget__learn-more-column--image"><div class="quiz-widget__learn-more-image"></div></div></div></div>');o.remove(),n.find("."+l).append(d),i.find(">div:first-child").append(u),t.insertBefore(i),e.append(n),s&&p.find(".quiz-widget__progress-bar").append('<div class="quiz-widget__progress-bar-item">'+s+"</div>"),h(".quiz-widget__learn-more-image").css("background-image",a),d.on("click",function(){this._triggerLearnMoreVisibility(!1)}.bind(this)),u.on("click",function(){this._triggerLearnMoreVisibility(!0)}.bind(this))}.bind(this)),h("."+g.progressBarWrapperClass).remove(),h(g.quizWrapper).prepend(p)},_createGetStarted:function(){var t="Quiz time: "+i.quizTimeMinutes+" minutes",t="<div class="+this.options.getStartedContainerClass+'><h3>Sleep Selector</h3><div class="quiz-widget__quiz-time">'+t+'</div><div class="quiz-widget__get-started-text">'+this.options.getStartedText+"</div><button class="+this.options.getStartedButtonClass+">Get started</button></div>";h("."+this.options.getStartedContainerClass).remove(),h("."+i.quizWrapper).prepend(t)},_initEvents:function(){var t=this.options;h("."+t.getStartedButtonClass).on("click",function(){this._beginQuiz(),this._setQuizTime()}.bind(this)),h(document).off("click",".quiz-lc #quiz-next"),h(document).on("click",".quiz-lc #quiz-next",function(t){setTimeout(function(){quiz.saveQ("E")},500)}.bind(this)),h(document).on("click",this.options.quizTabs+" .qp_flexc",function(t){t=h(t.currentTarget).parents(".take-q").parent().attr("tid"),t=this.getSelectedQuestionData(t),window.dataLayer=window.dataLayer||[],t=h.extend(t,{event:"selected_answer"});window.dataLayer.push(t)}.bind(this)),h(document).on("click","."+t.learnMoreClass,function(t){t=h(t.target);t.is(".quiz-widget__learn-more-holder")||0<t.parents(".quiz-widget__learn-more-holder").length||this._triggerLearnMoreVisibility(!1)}.bind(this)),h(document).on("click","."+t.formWrapperClass,function(t){t=h(t.target);t.is(".quiz-widget__send-results")||0<t.parents(".quiz-widget__send-results").length||this._triggerFormVisibility(!1)}.bind(this)),h(document).one("click",".quiz-lc #quiz-back",function(){window.location.hash="",this._reloadQuiz()}.bind(this)),h(document).on("click",".quiz-widget__email-results-button",function(){this._triggerFormVisibility(!0)}.bind(this)),h(document).on("click",".quiz-widget__warranty-button",function(t){var t=h(t.target),e=t.hasClass("next"),i=t.siblings(".quiz-widget__warranty-holder").find(".active"),e=i[e?"next":"prev"](),t=t.parent(),s=e.is(":last-child"),n=e.is(":first-child"),r=t.find(".prev"),t=t.find(".next");0<e.length&&(i.removeClass("active"),e.addClass("active")),t.css({opacity:s?0:1,pointerEvents:s?"none":"initial"}),r.css({opacity:n?0:1,pointerEvents:n?"none":"initial"})}),h(document).on("click","."+this.options.formSubmitButtonClass,this._sendForm.bind(this)),h(document).on("click","."+this.options.formCloseButtonClass,function(){this._triggerFormVisibility(!1)}.bind(this))},_reloadQuiz:function(){this._triggerQuizContainerVisibility(!1),this._triggerProgressBarVisibility(!1),this._getParent().html(""),this._loadQuiz()},_setQuizTime:function(){var t=6e4*+(i.quizTimeMinutes||2);this.quizTime=setTimeout(function(){this._reloadQuiz()}.bind(this),t)},_triggerQuizContainerVisibility:function(t){this._getParent().toggle(t)},_triggerQuizWrapperVisibility:function(t){h("."+i.quizWrapper).toggle(t)},_triggerLearnMoreVisibility:function(t){h("body").toggleClass("quiz-body-overflowed",t),h("."+this.options.learnMoreClass).toggle(t)},_triggerGetStartedVisibility:function(t){h("."+this.options.getStartedContainerClass).toggle(t)},_triggerFormVisibility:function(t){h("body").toggleClass("quiz-body-overflowed",t),h("."+this.options.formWrapperClass).toggle(t)},_triggerProgressBarVisibility:function(t){h("."+this.options.progressBarWrapperClass).toggle(t)},_beginQuiz:function(){this._triggerQuizContainerVisibility(!0),this._triggerProgressBarVisibility(!0),this._triggerGetStartedVisibility(!1),this._updateProgressBar()}};i&&t._create(),window.quizWidget=t}function incertGTM(){var t=window,e=document,i="dataLayer";t[i]=t[i]||[],t[i].push({"gtm.start":(new Date).getTime(),event:"gtm.js"}),t=e.getElementsByTagName("script")[0],(i=e.createElement("script")).async=!0,i.src=" https://www.googletagmanager.com/gtm.js?id=GTM-5F7CN2V",t.parentNode.insertBefore(i,t)}!function(){var a,t;function e(){a=window.jQuery.noConflict(!0),i()}function i(){var t=window,e=document,i="qp",s=void 0,n=void 0,r=document.querySelectorAll("A[quiz],DIV[quiz],A[data-quiz],DIV[data-quiz]");if(r&&r.length)for(var o=0;o<r.length;o++)r[o].id="quiz-embed-"+o,r[o].href="javascript:var i=document.getElementById('quiz-embed-"+o+"');try{qz.startQuiz(i)}catch(e){i.start=1;i.style.cursor='wait';i.style.opacity='0.5'};void(0);";t.QP=i,t.qp=t.qp||function(){(t.qp.q=t.qp.q||[]).push(arguments)},t.qp.l=+new Date,s=e.createElement("script"),n=e.getElementsByTagName("script")[0],s.async=1,s.src="//take.quiz-maker.com/3012/CDN/quiz-embed-v1.js",s.readyState?s.onreadystatechange=function(){"complete"!=this.readyState&&"loaded"!=this.readyState||quizWidget(a)}:s.onload=function(){quizWidget(a)},n.parentNode.insertBefore(s,n)}incertGTM(),void 0===window.jQuery||"3.6.0"!==window.jQuery.fn.jquery?((t=document.createElement("script")).setAttribute("type","text/javascript"),t.setAttribute("src","https://code.jquery.com/jquery-3.6.0.min.js"),t.readyState?t.onreadystatechange=function(){"complete"!=this.readyState&&"loaded"!=this.readyState||e()}:t.onload=e,(document.getElementsByTagName("head")[0]||document.documentElement).appendChild(t)):(a=window.jQuery,i())}();